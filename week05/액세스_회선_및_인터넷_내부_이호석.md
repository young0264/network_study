# 📌 04: 액세스 회선을 통해 인터넷의 내부로

## ✅ 01 ADSL 기술을 이용한 액세스 회선의 구조와 동작

### 1. 인터넷의 기본은 기정이나 회사의 LAN과 같다.

인터넷의 기본동작은 간단합니다.

라우터에서 패킷을 중계하는 가정이나 회사의 LAN과 기본적은 구조, 동작이 전혀 다르지 않습니다. 다만 네트워크의 규모가 매우 커진것을 인터넷이라고 생각할 수 있습니다.

다만 가정이나 회사의 LAN과는 몇가지 다른점이 존재합니다.

1. 인터넷의 중계장치간의 거리는 수 킬로미터 (태평양도 넘어야함) 이상으로 매우 멉니다. (이를 이더넷 케이블로 연결하기에는 어려움)
2. 패킷의 중계 대상을 제어하는 부분도 다름 → 너무 많은 경로정보가 라우터에 등록되어야 하므로 자동화가 필요합니다.
    
    이때 회사, 가정과는 다른 구조를 사용하여 경로 정보 등록을 자동화 합니다.
    
<br>

### 2. 사용자와 인터넷을 연결하는 액세스 회선

스위칭 허브, 라우터로 패킷을 중계하면 패킷은 목적지 서버를 향해 진행합니다. 또한 인터넷 접속용 라우터를 경유하며 인터넷으로 나가는데 여기서부터 4장의 이야기가 시작 됩니다.

- 인터넷 접속용 라우터는 액세스 회선의 규칙에 따라 패킷 송신 동작을 실행하는데 일반 가정에선 ADSL, FTTH, CATV, 전화 회선, ISDN등을 액세스 회선으로 사용합니다.

**책에서는 ADSL을 예시로 드는데 이는 일반 전화선을 사용하여 고속으로 데이터 통신을 할 수 있는 기술인 DSL(Digital Subscriber Line)중 하나입니다. → 음성 전화와는 별개의 주파수 대역을 사용하는 방식입니다.**

![image](https://github.com/young0264/network_study/assets/66772624/26cda305-0678-4101-b21d-7cef5cafaa0c)


 https://github.com/Road-of-CODEr/one-percent-network/blob/master/20201104/Chapter4.md

- **인터넷 접속용 라우터**
    
    이더넷의 규칙에 따라 패킷 송신 동작을 실행하지만, 이더넷의 헤더가 달라짐
    
    MAC 헤더(다음 전송할 모뎀의 MAC 주소), PPPoE 헤더, PPP헤더 3개의 헤더가 붙음, 이후 이더넷의 규칙에 따라 신호로 변환하여 ADSL 모뎀으로 송신합니다.
    
    - PPPoE, PPP 헤더
        
        PPP는 서로 다른 업체의 원격 액세스 SW들이 시리얼라인(인터넷 전용 선이 아닌 모뎀, 전화선 등) 상으로 서로 연결하여 TCP/IP 프로토콜로 통신할 수 있도록 만들기 위한 표준 규약임
        
        PPPoE는 PPP 프로토콜 기능을 이더넷을 통해 이용하기 위해 개발된 프로토콜
        
- **ADSL 모뎀**
    
    수신된 패킷을 셀로 분할하고, 전기 신호로 바꾸어 스플리터에 송신합니다.
    
    이때 ATM이라는 전화 회선 개념에 기초한 통신 방식을 이용하기 위해 셀로 분할합니다.
    
    - ADSL은 변조 방식으로 셀을 신호화 합니다.
        
        뭉개지기 쉬운 사각형 신호를 **ASK(진폭변조) + PSK(위상 변조)를 결합한 직교 진폭 변조(QAM)** 기술을 사용해 신호화 합니다.
        
    - ADSL은 사용자로부터 인터넷을 향하는 방향(업로드)과 인터넷에서 사용자를 향하는 방향(다운로드)전송 속도가 다릅니다.

- **스플리터**
    
    ADSL 모뎀에서 전기 신호로 변환한 셀은 스플리터 장치에 들어갑니다.
    
    스플리터는 ADSL 양쪽의 신호를 그대로 흘리기만 합니다.
    
    또한 전화 회선에서 신호가 흘러들어온 경우 전화와 ADSL의 신호를 나누는 역할을 합니다.
    즉, 들어온 신호를 분리해 전화기측에 ADSL의 신호가 흐르지 않도록 하는 역할입니다.(ADSL은 주로 높은 주파수이기에 가능함)
    

- **DSLAM(전화국용 집합 모뎀)**
    
    DSLAM은 전기 신호를 ATM 방식을 활용해 셀로 복원합니다.
    
    다수의 ADSL 모뎀에 해당하는 기능을 묶어 하나의 케이스에 넣은 DSLAM이라는 장치를 활용해 여러대의 ADSL 모뎀을 사용하지 않아도 됩니다.
    
    ADSL모뎀과 비슷하지만 DSLAM은 이더넷 대신에 ATM 인터페이스를 가진것이 대부분입니다.
    
    이후 BAS라는 패킷 중계 장치에 송신합니다.
    

- **BAS(Broadband Access Server)**
    
    ATM 인터페이스를 갖고 있고 셀을 수신함 이후 원래의 패킷을 차차 복원합니다.
    
    MAC 헤더와 PPPoE헤더는 BAS에 패킷을 건네주기위해 사용된 헤더이므로 버립니다. 이후 터널링용 헤더를 붙여서(L2TP) 터널링의 출구를 향해 중계합니다.
    

- **라우터(터널링용)**
    
    IP패킷을 추출하여 인터넷의 내부에 중계합니다.
    
<br><br>

## ✅ 02 광섬유를 이용한 액세스 회선(FTTH)

![image](https://github.com/young0264/network_study/assets/66772624/468c7542-38ed-4baf-9a04-61d36ade3993)

<br>

### 1. 광섬유의 기본

FTTH(Fiber To The Home) 액세스 회선은 광섬유를 이용한 방식입니다.

광섬유는 위 그림과 같은 구조로 이루어져 있고 코어 부분에 광신호를 흘려 데이터를 전달합니다. 이때 밝은 상태가 1, 어두운 상태가 0을 나타냅니다.

따라서 빛에 감응하여 밝기에 따라 전압을 발생시키는 수광 소자를 이용해 광신호로 전달받은 데이터를 디지털 데이터로 변환합니다.

<br>

### 2. 싱글모드와 멀티모드의 차이

광섬유의 원리는 빛이 통과하여 데이터를 전달한다입니다. 하지만 빛의 전달 방법은 복잡합니다.

내부의 클래딩에 부딪히며 전반사가 발생하는데 이때 같은 위상의 경우 중첩되지만, 다른 위상일 경우 상쇄돼는 경우가 발생합니다. (빛도 파장) 따라서 이러한 특성으로 인해 싱글모드와 멀티모드가 등장했습니다.

1. **싱글모드**
    - 코어의 직경이 가늘어 가장 작은 각도의 빛만 들어갈 수 있음 → 적은 반사 횟수로 코스도 짧아짐
    - 코어 속을 진행하는 빛이 하나이므로 광원, 수광 소자 성능이 높아야 합니다.
    - 신호의 변형이 적음
    - 주로 멀리 떨어진 장소에 있는 건물 사이를 연결할때 사용됩니다.
2. **멀티모드**
    - 코어의 직경이 굵어 입사각이 큰 빛도 들어갈 수 있고, 작은 빛도 들어가는 등 복수의 빛이 코어 속을 진행-합니다. → 다양한 반사 횟수 존재, 신호 변형 우려, 더 많은 시간 소요
    - 한 건물 안을 연결하는 용도로 사용됨
    
<br>

### 3. 광섬유를 분기시켜서 비용을 절감한다

ADSL 대신 광섬유를 사용해 사용자측 **인터넷 접속용 라우터**와 인터넷 측의 **BAS**를 접속하는 것이 **FTTH 액세스** 회선입니다.

- `미디어 컨버터 - 집합형 미디어 컨버터`를 사용하여 한 개의 광신호를 사용하는 유형이 있습니다.
- 광스플리터를 이용해 광섬유를 분기시켜 복수의 사용자를 연결하는 유형이 있습니다. (다수의 ONU가 OLT로 흘러가는 형태)
    - 내부에 타이밍을 조절하는 기능이 있으므로 패킷의 충돌을 방지할 수 있음

ADSL이던 FTTH던 모두 패킷을 운반한다는 역할은 동일합니다.

<br><br>

## ✅ 03 액세스 회선으로 이용하는 PPP와 터널링

### 1. 본인 확인과 설정 정보를 통지한다

ADSL, FTTH등의 액세스 회선에서 인터넷을 향해 흘러온 패킷은 액세스 회선을 운영하는 사업자가 소유한 BAS에 도착합니다.

BAS는 진화한 액세스 회선 연결 라우터로 `본인 확인`과 `설정값 통지 기능`이 추가됐습니다.

BAS는 로그인 창구 역할을 실현하기 위해 PPPoE라는 구조를 사용합니다. 이는 전화 회선을 이용한 다이얼업 접속으로 이용하는 PPP 구조를 발전시킨 것입니다.

- **PPP(Point-to-Point Protocol)**
    
    서로 다른 업체의 원격 액세스 SW들이 시리얼라인(인터넷 전용 선이 아닌 모뎀, 전화선 등) 상으로 서로 연결하여 TCP/IP 프로토콜로 통신할 수 있도록 만들기 위한 표준 규약임 
    
- **PPP 다이얼업 접속 동작**
    
    **책 참고**
    
<br>

### 2. 이더넷에서 PPP 메시지를 주고받는 PPPoE

ADSL, FTTH는 PC에 글로벌 주소를 설정하지 않으면 인터넷에 접속할 수 없습니다. (다이얼업 접속)

이를 가능케  하기 위해 PPP구조를 차용해 사용자명에 따른 프로바이더 전환에 편리함을 얻을 수 있습니다.

하지만, PPP 자체를 그대로 ADSL, FTTH에 사용할 수 없습니다.

- PPP의 메시지를 운반할때는 IP 패킷을 이더넷의 패킷에 넣어 운반하는 것과 같은 개념이 필요합니다.
- HDLC를 일반적으로 사용하지만, ADSL, FTTH는 사용할 수 없기에 PPPoE를 사용합니다.
- PPPoE는 PPP와 다른 개념적인 부분을 매울 사양을 새롭게 만든것입니다.

<br>

### 3. 터널링 기능에 의해 프로바이더에 패킷을 전달한다

터널링은 소켓과 소켓 사이를 연결하는 TCP의 커넥션(연결 장치)과 비슷합니다. 네트워크 안에 터널이 만들어지고, 그 속을 패킷이 통과한다는 방식입니다.

- **TCP 커넥션을 사용하여 터널링 실현**
    
    네트워크에 설치한 터널링용 라우터 사이에 TCP 커넥션을 만들고 커넥션의 양 끝에 있는 소켓 부분을 라우터의 포트로 간주하고 패킷을 송수신합니다.
    
- **캡슐화 방법을 사용하여 터널링 실현**
    
    캡슐화 방법을 사용하면 헤더도 포함한 패킷 전체를 별도의 패킷 안에 지정하여 터널의 반대쪽 출입구까지 운반합니다.
    
<br>

### 4. 액세스 회선 전체의 동작

1. 액세스 회선의 동작은 사용자측에 인터넷 접속용 라우터를 설치하고 인터넷에 접속하는 곳부터 시작됨
2. 인터넷 접속용 라우터에 프로바이더가 할당한 사용자명과 패스워드를 등록
3. 인터넷 접속용 라우터는 PPPoE의 Discovery 구조에 따라 BAS를 찾음
    - BAS의 MAC주소를 알고 대화할 수 있게 됨
4. 사용자명과 패스워드를 BAS에 보냄 (암호화 하거나 하지 않음)
5. 패스워드를 확인한 후 BAS에서 사용자에 대해 TCP/IP의 설정 정보를 통지함
    - `인터넷 접속 기기 할당 IP주소`, `DNS 서버 IP주소`, `기본 게이트웨이 IP 주소` 정보 통지함
6. 인터넷 접속용 라우터 사용시 설정 정보를 인터넷 접속용 라우터가 받아서 라우터 자체에 설정함
    - BAS측 포트에 글로벌 주소가 할당되고 경로표에 기본 게이트웨이도 설정됨
7. 인터넷 접속

<br>

### 5. IP 주소를 할당하지 않는 언넘버드

라우터의 포트끼리 하나의 케이블로 연결하는 상태에서 한쪽에서 송신한 패킷은 예외 없이 반대로 도착하므로 굳이 중계 대상의 주소를 조사하는 동작이 필요하지 않음

따라서 1:1 형태로 접속되어 있는 포트에는 IP 주소를 할당하지 않아도 상관없습니다. 현재는 이것이 관례가 되었고 이를 `unnumbered`라고 부릅니다.

<br>

### 6. 인터넷 접속용 라우터에서 private address를 global address로 변환한다

- PC에는 private address 주소를 할당하고 PC가 보낸 패킷은 인터넷 접속용 라우터에서 주소 변환 후 인터넷에 중계 됩니다.

<br>

### 7. PPPoE 이외의 방식

- PPPoA
    
    PPP 메시지를 이더넷 패킷에 저장하지 않고 메시지를 그대로 셀에 저장함 (MAC, PPPoE 헤더 없이도)
    
    짧은 헤더 덕분에 MTU가 늘어남
    
- DHCP
    
    DHCP는 주로 사내 LAN에서 클라이언트 PC의 TCP/IP의 설정정보를 통지하기 위해 사용됨
    
<br><br>

## ✅ 04 프로바이더의 내부

### 1. POP와 NOC

인터넷의 실체는 한 개의 조직이 운영 관리하는 단일 네트워크가 아니라 다수의 프로바이더의 네트워크를 서로 접속한 것임

1. POP(Point Of Presence)
    
    ADSL이나 FTTH의 액세스 회선은 사용자가 계약한 프로바이더의 설비에 연결되어 있음, 이 설비를 POP라고 합니다.
    
2. NOC(Network Operation Center)
    
    프로바이더의 핵심이 되는 설비로서 POP에서 들어온 패킷이 여기에 모여듭니다. 이곳에서 목적지 근처에 있는 POP이나 다른 프로바이더로 패킷이 흘러가는데 여기엔 고성능 라우터가 설치되어 있습니다.
    
<br><br>

## ✅ 05 프로바이더를 경유하여 흐르는 패킷

### 1. 프로바이더끼리의 접속

POP의 라우터에 도착한 패킷의 움직임을 살펴보면

1. 최종 목적지가 되는 웹 서버가 클라이언트와 같은 프로바이더에 접속되어 있는 경우
    - 프로바이더의 라우터는 라우터끼리 경로 정보를 교환하고, 이것을 경로표에 자동으로 등록합니다. 또한 해당 기능을 사용하여 경로 정보를 자동화 합니다.
    - 중계 대상을 파악하여 라우터를 서버측으로 향합니다.
        
        `POP → NOC … → 웹 서버측의 POP`, `NOC → POP → 웹 서버측의 POP`
        
<br>

### 2. 프로바이더끼리 경로 정보 교환하기

- **BGP(Border Gateway Protocol)**
    
    상대가 경로 정보를 가르쳐주면 이쪽에서도 같은 방법으로 경로 정보를 상대에게 통지 합니다. 이러면 라우터가 자동적으로 경로 정보 교환을 수행하고 사용하는 구조를 BGP라고 말합니다.
    

- 경로 정보 교환 방식
    - 트랜지트(transit): 접속 상대에게 자신이 알고있는 전체 경로를 통지합니다.
    - 피어(peer): 두 프로바이더가 각각의 네트워크에 관한 경로 정보만 상대에게 통지함

<br>

### 4. IX의 필요성

IX는 중심이 되는 설비를 설치하고 이것을 경유하여 접속하는 방법을 선택하면 통신 회선의 수를 억제할 수 있습니다. 이때 중심이 되는 설비를 IX라고 합니다.

<br>

### 5. IX에서 프로바이더끼리 접속하는 모습

**책 참조..!**
